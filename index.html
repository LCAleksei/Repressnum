<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ€§å‹æŠ‘æŒ‡æ•°è®¡ç®—å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/pinyin@4.0.0/lib/umd/pinyin.js"></script>
    <script src="https://unpkg.com/wanakana@5.3.1/wanakana.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            min-height: 100vh;
        }
        .steel-text {
            background: linear-gradient(90deg, #a8a8a8, #d4d4d4, #a8a8a8, #858585, #a8a8a8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
            background-size: 200% auto;
            animation: steel-shine 3s linear infinite;
        }
        @keyframes steel-shine {
            to { background-position: 200% center; }
        }
        .progress-bar-inner {
            transition: width 0.8s cubic-bezier(0.25, 0.1, 0.25, 1), background-color 0.8s ease;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-6px); }
            20%, 40%, 60%, 80% { transform: translateX(6px); }
        }
        .shake { animation: shake 0.5s ease-in-out; }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in-up { animation: fadeInUp 0.6s ease-out forwards; }
        @keyframes initial-fade-in {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .container-fade-in { animation: initial-fade-in 0.7s cubic-bezier(0.25, 0.1, 0.25, 1) forwards; }
        @keyframes pop-in {
            0% { transform: scale(0.8); opacity: 0; }
            70% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }
        .pop-in { animation: pop-in 0.5s cubic-bezier(0.25, 0.1, 0.25, 1) forwards; }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 8px rgba(100, 100, 100, 0.3), 0 0 12px rgba(100, 100, 100, 0.2); }
            50% { box-shadow: 0 0 16px rgba(100, 100, 100, 0.7), 0 0 24px rgba(100, 100, 100, 0.5); }
        }
        .pulsing-glow { animation: pulse-glow 1.5s infinite ease-in-out; }
        .lock-icon {
            display: inline-block;
            margin-right: 8px;
            font-size: 1.2em;
        }
        .language-selector {
            position: absolute;
            top: 80px;
            right: 20px;
            z-index: 20;
        }
        .fixed-name-tag {
            display: inline-block;
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            margin-left: 8px;
            vertical-align: middle;
        }
        .country-alert {
            background: linear-gradient(90deg, #1e40af, #1e3a8a);
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin-top: 16px;
            animation: fadeInUp 0.6s ease-out forwards;
        }
        .github-link {
            margin-top: 16px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 0.8rem;
        }
        
        /* æ–°å¢åŠ¨ç”»æ ·å¼ */
        @keyframes input-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.3); }
            50% { box-shadow: 0 0 15px rgba(59, 130, 246, 0.7); }
        }
        .input-glow { animation: input-glow 2s infinite ease-in-out; }
        
        @keyframes ripple {
            to { transform: scale(4); opacity: 0; }
        }
        .ripple {
            position: absolute;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.4);
            transform: scale(0);
            animation: ripple 0.6s linear;
        }
        
        @keyframes card-float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        .card-float { animation: card-float 3s ease-in-out infinite; }
    </style>
</head>
<body class="flex items-center justify-center p-4">
    <div class="language-selector">
        <select id="languageSelect" class="bg-gray-700 text-white py-2 px-3 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="zh-CN">ä¸­æ–‡</option>
            <option value="en-US">English</option>
            <option value="ja-JP">æ—¥æœ¬èª</option>
            <option value="ko-KR">í•œêµ­ì–´</option>
            <option value="fr-FR">FranÃ§ais</option>
        </select>
    </div>

    <div class="fixed top-0 left-0 right-0 p-4 flex justify-between items-center z-10">
        <div class="relative">
            <button id="historyToggleBtn" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full transition duration-300 transform hover:scale-105 active:scale-95 shadow-lg">
                <span id="historyText">å†å²è®°å½•</span>
            </button>
            <div id="historyPanel" class="hidden mt-2 w-64 bg-gray-800 rounded-lg shadow-xl p-4 space-y-2 max-h-64 overflow-y-auto absolute left-0">
                <h3 class="text-lg font-semibold text-gray-300 mb-3" id="historyTitle">å†å²è®°å½•</h3>
                <ul id="historyList" class="space-y-2 text-sm text-gray-400">
                </ul>
                <button id="clearHistoryBtn" class="w-full mt-4 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 transform hover:scale-105 active:scale-95 shadow-lg text-sm">
                    <span id="clearHistoryText">æ¸…é™¤å†å²è®°å½•</span>
                </button>
                <p class="text-xs text-gray-500 mt-4" id="historyNote">æˆ‘ä»¬ä¸ä½¿ç”¨æ‚¨è¾“å…¥çš„ä¿¡æ¯ï¼Œç»“æœä»…ä¾›å¨±ä¹ã€‚</p>
            </div>
        </div>

        <div class="relative">
            <button id="shareButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full transition duration-300 transform hover:scale-105 active:scale-95 shadow-lg hidden">
                <span id="shareText">åˆ†äº«</span>
            </button>
        </div>
    </div>

    <div class="w-full max-w-md mx-auto bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8 space-y-6 container-fade-in">
        <div class="text-center">
            <h1 class="text-3xl font-bold steel-text" id="mainTitle">æ€§å‹æŠ‘æŒ‡æ•°è®¡ç®—å™¨</h1>
            <p class="text-gray-400 mt-2" id="subTitle">è¾“å…¥ä¸€ä¸ªåå­—ï¼Œçœ‹çœ‹"ç§‘å­¦ï¼ˆå¹¶ä¸ï¼‰"çš„è®¡ç®—ç»“æœï¼</p>
            <p class="text-xs text-gray-500 mt-1" id="disclaimer">ï¼ˆçº¯å±å¨±ä¹ï¼Œè¯·å‹¿å½“çœŸï¼‰</p>
        </div>

        <div class="space-y-4">
            <input type="text" id="nameInput" placeholder="è¾“å…¥ä»»ä½•åå­—æˆ–ç½‘å" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-300">
            <button id="calculateBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 transform hover:scale-105 active:scale-95 shadow-lg relative overflow-hidden">
                <span id="btnText">å¼€å§‹è®¡ç®—</span>
                <span id="btnSpinner" class="hidden animate-spin">â—</span>
            </button>
        </div>

        <div id="resultSection" class="hidden pt-6 space-y-4 text-center">
            <h2 class="text-xl font-semibold text-gray-300 fade-in-up">
                <span id="resultForText">è®¡ç®—ç»“æœ for</span> "<span id="resultName" class="font-bold text-blue-400"></span>"
                <span id="fixedNameBadge" class="fixed-name-tag hidden">å›ºå®šç»“æœ</span>
            </h2>
            
            <div class="relative w-full h-8 bg-gray-700 rounded-full overflow-hidden border-2 border-gray-600">
                <div id="progressBar" class="progress-bar-inner h-full rounded-full" style="width: 0%;"></div>
                <span id="percentageText" class="absolute inset-0 flex items-center justify-center text-sm font-bold text-white opacity-0">0%</span>
            </div>

            <p id="resultMessage" class="text-lg font-medium text-gray-200 min-h-16 flex items-center justify-center"></p>
            
            <div id="countryAlert" class="country-alert hidden">
                <span class="lock-icon">ğŸ”“</span>
                <span id="countryAlertText"></span>
            </div>
            
            <div id="githubLink" class="github-link text-gray-400 hidden">
                <span id="githubText">åŸºäºé¡¹ç›®ï¼š</span>
                <a href="https://github.com/LCAleksei/Repressnum" target="_blank" id="githubUrl" class="text-blue-400 hover:text-blue-300 transition-colors duration-300">GitHub: LCAleksei/Repressnum</a>
            </div>
        </div>
    </div>

    <div class="fixed bottom-4 right-4 text-xs text-gray-600">
        <a href="#" class="hover:text-gray-500 transition-colors duration-300">
            <span id="footerText">ä»…ä¾›å¨±ä¹</span>
        </a>
    </div>

    <script>
        window.onload = function() {
            // HTMLè½¬ä¹‰å‡½æ•° - é˜²æ­¢XSSæ”»å‡»
            function escapeHtml(unsafe) {
                if (!unsafe) return '';
                return unsafe
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
            }

            const translations = {
                'zh-CN': {
                    history: 'å†å²è®°å½•',
                    clearHistory: 'æ¸…é™¤å†å²è®°å½•',
                    historyNote: 'æˆ‘ä»¬ä¸ä½¿ç”¨æ‚¨è¾“å…¥çš„ä¿¡æ¯ï¼Œç»“æœä»…ä¾›å¨±ä¹ã€‚',
                    share: 'åˆ†äº«',
                    mainTitle: 'æ€§å‹æŠ‘æŒ‡æ•°è®¡ç®—å™¨',
                    subTitle: 'è¾“å…¥ä¸€ä¸ªåå­—ï¼Œçœ‹çœ‹"ç§‘å­¦ï¼ˆå¹¶ä¸ï¼‰"çš„è®¡ç®—ç»“æœï¼',
                    disclaimer: 'ï¼ˆçº¯å±å¨±ä¹ï¼Œè¯·å‹¿å½“çœŸï¼‰',
                    placeholder: 'è¾“å…¥ä»»ä½•åå­—æˆ–ç½‘å',
                    calculate: 'å¼€å§‹è®¡ç®—',
                    resultFor: 'è®¡ç®—ç»“æœ for',
                    footer: 'ä»…ä¾›å¨±ä¹',
                    countryAlert: 'æ€§å‹æŠ‘å·²åœ¨{}ä¼ æ’­ï¼',
                    githubText: 'åŸºäºé¡¹ç›®ï¼š',
                    specialNames: {
                        'è€„è€‹': { percentage: 100, message: 'å“ˆï¼', fixed: true },
                        'Minecraft': { percentage: 2009.0513, message: 'ä½ è¯´å¾—å¯¹ï¼Œä½†æ˜¯Minecraftæ˜¯ä¸€æ¬¾ç”±Mojang Studioså¼€å‘çš„æ²™ç›’ç±»ç”µå­æ¸¸æˆ', fixed: true },
                        'GitHub': { percentage: 100, message: 'Î£(ã£ Â°Ğ” Â°;) ã£', fixed: true },
                        'Terraria': { percentage: 2011.0516, message: 'ä½ è¯´å¾—å¯¹ï¼Œä½†æ˜¯æ³°æ‹‰ç‘äºš æ˜¯ä¸€æ¬¾å…³äºç”Ÿå­˜ã€å†’é™©ã€åˆ›é€  å’Œè‚ç¡¬åŒ–çš„æ¸¸æˆ', fixed: true },
                        'ç”°æ‰€æµ©äºŒ': { percentage: 114, message: '114514', fixed: true }
                    }
                },
                'en-US': {
                    history: 'History',
                    clearHistory: 'Clear History',
                    historyNote: 'We do not use your input information, results are for entertainment only.',
                    share: 'Share',
                    mainTitle: 'Repression Index Calculator',
                    subTitle: 'Enter a name to see the "scientific" result!',
                    disclaimer: '(For entertainment only)',
                    placeholder: 'Enter any name or nickname',
                    calculate: 'Calculate',
                    resultFor: 'Result for',
                    footer: 'For Entertainment Only',
                    countryAlert: 'Sexual repression has spread in {}!',
                    githubText: 'Based on project: ',
                    specialNames: {}
                },
                'ja-JP': {
                    history: 'å±¥æ­´',
                    clearHistory: 'å±¥æ­´ã‚’ã‚¯ãƒªã‚¢',
                    historyNote: 'å…¥åŠ›ã•ã‚ŒãŸæƒ…å ±ã¯ä½¿ç”¨ã›ãšã€çµæœã¯å¨¯æ¥½ç›®çš„ã®ã¿ã§ã™ã€‚',
                    share: 'å…±æœ‰',
                    mainTitle: 'æ€§æŠ‘åœ§æŒ‡æ•°è¨ˆç®—æ©Ÿ',
                    subTitle: 'åå‰ã‚’å…¥åŠ›ã—ã¦ã€Œç§‘å­¦çš„ã€ãªçµæœã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼',
                    disclaimer: 'ï¼ˆå¨¯æ¥½ç›®çš„ã®ã¿ï¼‰',
                    placeholder: 'ä»»æ„ã®åå‰ã¾ãŸã¯ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’å…¥åŠ›',
                    calculate: 'è¨ˆç®—ã™ã‚‹',
                    resultFor: 'ã®çµæœ',
                    footer: 'å¨¯æ¥½ã®ã¿',
                    countryAlert: 'æ€§çš„æŠ‘åœ§ãŒ{}ã§åºƒãŒã£ã¦ã„ã¾ã™ï¼',
                    githubText: 'åŸºã¥ããƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼š',
                    specialNames: {}
                },
                'ko-KR': {
                    history: 'ê¸°ë¡',
                    clearHistory: 'ê¸°ë¡ ì§€ìš°ê¸°',
                    historyNote: 'ê·€í•˜ì˜ ì…ë ¥ ì •ë³´ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©°, ê²°ê³¼ëŠ” ì˜¤ë½ ëª©ì ìœ¼ë¡œë§Œ ì œê³µë©ë‹ˆë‹¤.',
                    share: 'ê³µìœ ',
                    mainTitle: 'ì„± ì–µì•• ì§€ìˆ˜ ê³„ì‚°ê¸°',
                    subTitle: 'ì´ë¦„ì„ ì…ë ¥í•˜ì—¬ "ê³¼í•™ì ì¸" ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”!',
                    disclaimer: '(ì˜¤ë½ ëª©ì  ì „ìš©)',
                    placeholder: 'ì´ë¦„ì´ë‚˜ ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”',
                    calculate: 'ê³„ì‚°í•˜ê¸°',
                    resultFor: 'ê²°ê³¼ for',
                    footer: 'ì˜¤ë½ ëª©ì  ì „ìš©',
                    countryAlert: 'ì„±ì  ì–µì••ì´ {}ì—ì„œ í™•ì‚°ë˜ê³  ìˆìŠµë‹ˆë‹¤!',
                    githubText: 'ê¸°ë°˜ í”„ë¡œì íŠ¸ï¼š',
                    specialNames: {}
                },
                'fr-FR': {
                    history: 'Historique',
                    clearHistory: 'Effacer l\'historique',
                    historyNote: 'Nous n\'utilisons pas vos informations, les rÃ©sultats sont uniquement Ã  des fins de divertissement.',
                    share: 'Partager',
                    mainTitle: 'Calculateur d\'Indice de RÃ©pression',
                    subTitle: 'Entrez un nom pour voir le rÃ©sultat "scientifique"!',
                    disclaimer: '(Ã€ des fins de divertissement uniquement)',
                    placeholder: 'Entrez un nom ou un pseudonyme',
                    calculate: 'Calculer',
                    resultFor: 'RÃ©sultat pour',
                    footer: 'Ã€ des fins de divertissement uniquement',
                    countryAlert: 'La rÃ©pression sexuelle s\'est propagÃ©e en {}!',
                    githubText: 'BasÃ© sur le projet: ',
                    specialNames: {}
                }
            };

            const countryMap = {
                'zh-CN': 'ä¸­å›½',
                'en-US': 'United States',
                'ja-JP': 'æ—¥æœ¬',
                'ko-KR': 'éŸ©å›½',
                'fr-FR': 'France'
            };

            const messageTiers = {
                0: [ 
                    "0%... ä½ æ˜¯å¼€æ”¾æˆç²¾äº†å—ï¼Ÿ", "é›¶å‹æŠ‘ï¼ä½ çš„ä¸–ç•Œé‡Œè¿å½©è™¹éƒ½æ˜¯å½©è‰²çš„å—ï¼Ÿ", "æˆåˆ†è¿‡çº¯ï¼Œå»ºè®®å»å¤œåº—å½“DJã€‚", 
                    "æ¯”è€å­çš„æ”¯ä»˜å®ä½™é¢è¿˜è‡ªç”±ï¼Œä»¤äººç¾¡æ…•ã€‚", "æ£€æµ‹ä¸åˆ°ä»»ä½•å‹æŠ‘è¿¹è±¡ï¼Œç¨‹åºå¯èƒ½å‡ºé”™äº†ã€‚", "ä½ å¼€æ”¾å¾—åƒå¤å¨å¤·çš„æµ·æ»©ï¼Œæ¯«æ— é®æ©ã€‚",
                    "ä¿®å¥³è§äº†ä½ éƒ½å¾—è„¸çº¢ï¼Œç”Ÿæ€•è¢«ä½ å¸¦åã€‚", "ä½ çš„ç”Ÿæ´»é‡Œæ˜¯ä¸æ˜¯åªæœ‰'éšå¿ƒæ‰€æ¬²'è¿™æ¡äººç”Ÿä¿¡æ¡ï¼Ÿ", "ä½ å°±æ˜¯ä¼ è¯´ä¸­çš„'è§£æ”¾å¤©æ€§'ä»£è¨€äººæœ¬äººã€‚",
                    "ä½ å¯¹'å‹æŠ‘'çš„å”¯ä¸€è®¤çŸ¥ï¼Œå¯èƒ½å°±æ˜¯å­—å…¸é‡Œçš„é‚£ä¸ªè¯ã€‚", "æ¯«æ— ä¿ç•™ï¼Œæ¯«æ— å‹æŠ‘ï¼Œä»¤äººç¾¡æ…•ï¼", "ä½ çš„æƒ…æ„Ÿè¡¨è¾¾å¦‚åŒç€‘å¸ƒèˆ¬è‡ªç„¶æµç•…ã€‚", "æ£€æµ‹ä¸åˆ°ä»»ä½•å‹æŠ‘è¿¹è±¡ï¼Œæ´»å¾—çœŸå®ï¼"
                ],
                20: [ 
                    "è½»åº¦å‹æŠ‘ï¼Œå¶å°”ä¼šéšè—çœŸå®æ„Ÿå—ã€‚", "åƒå¤§å¤šæ•°äººä¸€æ ·ï¼Œæœ‰æ—¶ä¼šå…‹åˆ¶è‡ªå·±ã€‚", "ä½ çš„æƒ…æ„Ÿè¡¨è¾¾åŸºæœ¬è‡ªç„¶ï¼Œä½†å¶å°”ä¼šçŠ¹è±«ã€‚", 
                    "å°å°çš„å‹æŠ‘ï¼Œåƒå¾®é£ä¸­çš„ä¸€ä¸å‡‰æ„ã€‚", "åŸºæœ¬æ­£å¸¸çš„æƒ…æ„Ÿè¡¨è¾¾ï¼Œå¶å°”æœ‰æ‰€ä¿ç•™ã€‚", "ä½ å¤§è„‘é‡Œçš„'ä¿å®ˆ'åŒºåŸŸï¼Œå¯¼èˆªéƒ½æœä¸åˆ°ã€‚",
                    "å¦‚æœå¼€æ”¾èƒ½å‘ç”µï¼Œä½ å°±æ˜¯ä¸ªæ°¸åŠ¨æœºã€‚", "ä½ å¤§æ¦‚å°±æ˜¯é‚£ç§ä¼šé—®'ä¸ºä»€ä¹ˆäººè¦å‹æŠ‘è‡ªå·±'çš„äººã€‚", "ä½ å¯¹æ€§æ„Ÿçš„è®¤çŸ¥ï¼Œå°±åƒNetflixä¸€æ ·ä¸°å¯Œå¤šå½©ã€‚",
                    "ä½ æ€•ä¸æ˜¯å¼€æ”¾å…³ç³»åŸ¹è®­ç­é‡Œçš„è¯¾ä»£è¡¨ï¼Ÿ"
                ],
                40: [ 
                    "ä¸­åº¦å‹æŠ‘ï¼Œæ—¶å¸¸éšè—çœŸå®æƒ…æ„Ÿã€‚", "ä½ çš„å†…å¿ƒæœ‰ä¸€åº§å°å°çš„æƒ…æ„Ÿå ¤åã€‚", "ä¹ æƒ¯æ€§åœ°æˆ´ä¸Šç¤¾ä¼šæœŸå¾…çš„é¢å…·ã€‚", 
                    "åƒè¢«è½»è½»é”ä½çš„æƒ…æ„Ÿï¼Œéœ€è¦é’¥åŒ™æ‰èƒ½é‡Šæ”¾ã€‚", "ä½ çš„æƒ…æ„Ÿåƒè¢«ä¿®å‰ªè¿‡çš„èŠ±å›­ï¼Œæ•´é½ä½†å—é™ã€‚", "ä½ ä»¥ä¸ºä½ æ˜¯å¼€æ”¾çš„ï¼Œå…¶å®ä½ åªæ˜¯ä¸ªæœ‰ç‚¹ä¿å®ˆçš„é¦™è•‰ã€‚",
                    "ä½ çš„æŸœé—¨å¼€äº†ä¸€æ¡ç¼ï¼Œä½†ä½ ä»¥ä¸ºé‚£æ˜¯é“å¾·åº•çº¿ã€‚", "çœ‹åˆ°æ€§æ„Ÿçš„äººï¼Œä½ ä¼šå¿ƒæƒ³ï¼š'è¿™èº«æçœŸæ£’ï¼Œå¯æƒœæˆ‘ä¸èƒ½è¡¨ç°å‡ºæ¥'ã€‚", 
                    "ä½ å·²ç»å¼€å§‹æ€è€ƒï¼Œä¸ºä»€ä¹ˆç¤¾ä¼šæœ‰é‚£ä¹ˆå¤šç¦å¿Œã€‚", "ä½ çš„æ€§è§‚å¿µå°±åƒè–›å®šè°”çš„çŒ«ï¼Œä¸è¯•æ¢å‰è°ä¹Ÿè¯´ä¸å‡†ã€‚"
                ],
                60: [ 
                    "é«˜åº¦å‹æŠ‘ï¼Œæƒ…æ„Ÿå¾ˆå°‘å¤–éœ²ã€‚", "ä½ çš„å†…å¿ƒæœ‰å¤šé‡é—¨é”ï¼Œéš¾ä»¥å¼€å¯ã€‚", "ä¹ æƒ¯æ€§åœ°æˆ´ä¸Šç¤¾ä¼šæœŸå¾…çš„é¢å…·ã€‚", 
                    "æƒ…æ„Ÿåƒè¢«ä¸¥æ ¼ç®¡ç†çš„èµ„æºï¼Œå¾ˆå°‘æ”¾çºµã€‚", "ä½ çš„è¡¨è¾¾æ–¹å¼åƒç»è¿‡ä¸¥æ ¼å®¡æ ¸çš„æ–‡ä»¶ã€‚", "æœ‰ç‚¹æ„æ€ï¼Œä½ çš„ä¿å®ˆé›·è¾¾çš„æŒ‡é’ˆåŠ¨äº†ä¸€ä¸‹ã€‚",
                    "å·²ç»å¼€å§‹å¯¹ä¸€äº›ç‰¹å®šç±»å‹çš„æ¬²æœ›äº§ç”Ÿå¥½å¥‡äº†ã€‚", "ä½ ç¦»è§£æ”¾å¤©æ€§ï¼Œå°±å·®ä¸€ä¸ªå¥‘æœºã€‚", "å˜´ä¸Šè¯´ç€ä¸è¦ï¼Œèº«ä½“å´å¾ˆè¯šå®ã€‚",
                    "æ˜¯æ—¶å€™æ›´æ–°ä¸€ä¸‹ä½ çš„é“å¾·è§‚å¿µç­›é€‰å™¨äº†ã€‚"
                ],
                80: [ 
                    "ä¸¥é‡å‹æŠ‘ï¼Œå‡ ä¹ä»ä¸è¡¨è¾¾çœŸå®æƒ…æ„Ÿã€‚", "ä½ çš„å†…å¿ƒåƒä¸Šäº†å¤šé‡é”çš„ä¿é™©ç®±ã€‚", "æƒ…æ„Ÿè¢«æ·±åŸ‹ï¼Œå‡ ä¹ä»ä¸å¤–éœ²ã€‚", 
                    "åƒç”Ÿæ´»åœ¨æ— å½¢çš„ç¬¼å­é‡Œï¼Œè‡ªæˆ‘é™åˆ¶æå¼ºã€‚", "ä½ çš„æƒ…æ„Ÿè¡¨è¾¾åƒæ˜¯ç»è¿‡å±‚å±‚è¿‡æ»¤çš„å‡€æ°´ã€‚", "åˆ«è£…äº†ï¼Œä½ çš„èº«ä½“ååº”å‡ºå–äº†ä½ ï¼",
                    "æ€§å‹æŠ‘é›·è¾¾å·²ç»å¼€å§‹æŠ¥è­¦ï¼Œåªæ˜¯å£°éŸ³æ¯”è¾ƒå°ã€‚", "ä½ æ€•ä¸æ˜¯ç¦æ¬²ç³»çš„å¸¸é©»å˜‰å®¾ï¼Ÿ", "è¯´å§ï¼Œä½ å·å·çœ‹è¿‡å¤šå°‘å°é»„ä¹¦ï¼Ÿ",
                    "çœ‹åˆ°åˆºæ¿€çš„å†…å®¹ä¼šå¿ƒè·³åŠ é€Ÿï¼Œä½†å‡è£…æ²¡çœ‹è§ã€‚"
                ],
                90: [ 
                    "æåº¦å‹æŠ‘ï¼Œæƒ…æ„Ÿå‡ ä¹å®Œå…¨å°é—­ã€‚", "ä½ çš„å†…å¿ƒåƒ fortressï¼Œéš¾ä»¥æ”»ç ´ã€‚", "æƒ…æ„Ÿè¢«å‹ç¼©åˆ°å‡ ä¹ä¸å­˜åœ¨çš„åœ°æ­¥ã€‚", 
                    "åƒæ˜¯æƒ…æ„Ÿçš„è‹¦è¡Œåƒ§ï¼Œæåº¦å…‹åˆ¶è‡ªå·±ã€‚", "ä½ çš„è¡¨è¾¾æ–¹å¼åƒæ˜¯ç²¾å¯†è®¡ç®—çš„æœºå™¨ã€‚", "è¡£æŸœé—¨éƒ½å¿«å…³ä¸ä½äº†å§ï¼é‡Œé¢è—äº†å¤šå°‘ç§˜å¯†ï¼Ÿ",
                    "æ€§å‹æŠ‘ä¿¡å·å¼ºåº¦å·²çˆ†è¡¨ï¼", "ä¸‹ä¸€æ­¥æ˜¯ä¸æ˜¯å°±è¦ç«‹åœ°æˆä½›äº†ï¼Ÿ", "ä½ å‹æŠ‘å¾—åƒç›˜èšŠé¦™ï¼Œè¿˜å¸¦é”çš„é‚£ç§ã€‚",
                    "åˆ«ç‚¹äº†ï¼Œè‡ªå·±äººï¼Œå¿«å¼€é—¨ï¼æˆ‘ä»¬çŸ¥é“ä½ åœ¨è£…ï¼"
                ],
                100: [ 
                    "100%å‹æŠ‘ï¼æƒ…æ„Ÿå®Œå…¨å°é—­ï¼", "ç»ˆæå‹æŠ‘å¤§å¸ˆï¼æƒ…æ„Ÿå‡ ä¹ä¸å­˜åœ¨ï¼", "ä½ çš„å†…å¿ƒåƒé»‘æ´ï¼Œå¸æ”¶ä¸€åˆ‡æƒ…æ„Ÿå´ä¸é‡Šæ”¾ã€‚", 
                    "æƒ…æ„Ÿè¢«å‹ç¼©åˆ°é‡å­çº§åˆ«ï¼Œå‡ ä¹æ— æ³•æ¢æµ‹ã€‚", "ä½ æ˜¯æƒ…æ„Ÿå‹æŠ‘çš„ç»ˆæå½¢æ€ï¼", "è­¦æŠ¥ï¼å·²æ— éœ€é‰´å®šï¼Œå¤©ç”Ÿçš„æ€§å†·æ·¡ï¼",
                    "ä½ å°±æ˜¯å‹æŠ‘æœ¬æŠ‘ï¼", "æ­å–œï¼ä½ å·²è§£é”'æ€§å‹æŠ‘å¤©èŠ±æ¿'æˆå°±ï¼", "å‹æŠ‘å¾—å½»åº•ï¼Œè¿æ¢¦éƒ½æ˜¯æ¸…å¿ƒå¯¡æ¬²çš„ã€‚",
                    "å‡ºå‚è®¾ç½®å°±æ˜¯å‹æŠ‘çš„ï¼Œåˆ«æŒ£æ‰äº†ã€‚", "ä½ ä¸æ˜¯æ€§å†·æ·¡ï¼Œä½ æ˜¯æ€§å†·æ·¡çš„CEOï¼", "æ€§æ¬²é‡è¡¨åœ¨ä½ é¢å‰éƒ½å¾—æ–°å¢ä¸€ä¸ªè´Ÿç»´åº¦ã€‚",
                    "ä½ ä¸€å¼ å˜´ï¼Œæ–¹åœ†åé‡Œçš„æ¬²æœ›éƒ½å¾—ç˜«ç—ªã€‚", "åˆ«ç®—äº†ï¼Œå¿«å»å¯ºåº™æŠ¥åˆ°å½“ä½æŒï¼", "ä½ ä»–å¦ˆçš„æ˜¯ä¸æ˜¯ä»å°è¢«é˜‰å‰²äº†ï¼Ÿæ€ä¹ˆä¸€ç‚¹æ¬²æœ›éƒ½æ²¡æœ‰ï¼",
                    "æ“ï¼Œä½ è¿™å‹æŠ‘ç¨‹åº¦è¿å’Œå°šéƒ½è‡ªæ„§ä¸å¦‚ï¼", "å¦ˆçš„ï¼Œä½ æ˜¯ä¸æ˜¯æ€§åŠŸèƒ½æœ‰éšœç¢å•Šï¼Ÿè¿™ä¹ˆèƒ½æ†‹ï¼", "æ—¥ï¼Œä½ è¿™å‹æŠ‘æ°´å¹³å¯ä»¥å»ç”³è¯·å‰å°¼æ–¯ä¸–ç•Œçºªå½•äº†ï¼",
                    "é ï¼Œä½ è¿™æ ·å­æ˜¯è¦ä¿®ä»™å•Šï¼Ÿå®Œå…¨ä¸éœ€è¦æ€§ç”Ÿæ´»ï¼Ÿ", "æ·¦ï¼Œä½ è¿™å‹æŠ‘èƒ½åŠ›ç®€ç›´æ˜¯äººç±»è¿›åŒ–å²ä¸Šçš„å¥‡è¿¹ï¼"
                ]
            };

            const elements = {
                nameInput: document.getElementById('nameInput'),
                calculateBtn: document.getElementById('calculateBtn'),
                btnText: document.getElementById('btnText'),
                btnSpinner: document.getElementById('btnSpinner'),
                resultSection: document.getElementById('resultSection'),
                resultName: document.getElementById('resultName'),
                progressBar: document.getElementById('progressBar'),
                percentageText: document.getElementById('percentageText'),
                resultMessage: document.getElementById('resultMessage'),
                shareButton: document.getElementById('shareButton'),
                historyToggleBtn: document.getElementById('historyToggleBtn'),
                historyPanel: document.getElementById('historyPanel'),
                historyList: document.getElementById('historyList'),
                clearHistoryBtn: document.getElementById('clearHistoryBtn'),
                languageSelect: document.getElementById('languageSelect'),
                fixedNameBadge: document.getElementById('fixedNameBadge'),
                countryAlert: document.getElementById('countryAlert'),
                githubLink: document.getElementById('githubLink'),
                historyText: document.getElementById('historyText'),
                historyTitle: document.getElementById('historyTitle'),
                clearHistoryText: document.getElementById('clearHistoryText'),
                historyNote: document.getElementById('historyNote'),
                shareText: document.getElementById('shareText'),
                mainTitle: document.getElementById('mainTitle'),
                subTitle: document.getElementById('subTitle'),
                disclaimer: document.getElementById('disclaimer'),
                resultForText: document.getElementById('resultForText'),
                footerText: document.getElementById('footerText'),
                countryAlertText: document.getElementById('countryAlertText'),
                githubText: document.getElementById('githubText'),
                githubUrl: document.getElementById('githubUrl')
            };

            let typingInterval;
            let titleAnimationId;
            let currentLanguage = 'zh-CN';
            let originalTitle = document.title;

            // æ·»åŠ æŒ‰é’®æ¶Ÿæ¼ªæ•ˆæœ
            function createRipple(event) {
                const button = event.currentTarget;
                const circle = document.createElement("span");
                const diameter = Math.max(button.clientWidth, button.clientHeight);
                const radius = diameter / 2;

                circle.style.width = circle.style.height = `${diameter}px`;
                circle.style.left = `${event.clientX - button.getBoundingClientRect().left - radius}px`;
                circle.style.top = `${event.clientY - button.getBoundingClientRect().top - radius}px`;
                circle.classList.add("ripple");

                const ripple = button.getElementsByClassName("ripple")[0];
                if (ripple) ripple.remove();

                button.appendChild(circle);
            }

            // æ›´æ–°æµè§ˆå™¨æ ‡é¢˜åŠ¨ç”»
            function updateTitleAnimation(percentage, isFinalResult = false) {
                if (titleAnimationId) {
                    cancelAnimationFrame(titleAnimationId);
                }
                
                const t = translations[currentLanguage];
                const titlePrefix = t.mainTitle;
                
                function animateTitle() {
                    if (isFinalResult) {
                        document.title = `ç»“æœ... ${percentage.toFixed(4)}% - ${titlePrefix}`;
                    } else {
                        document.title = `è¿›åº¦... ${percentage.toFixed(4)}% - ${titlePrefix}`;
                    }
                    
                    if (percentage < 100 && !isFinalResult) {
                        titleAnimationId = requestAnimationFrame(animateTitle);
                    } else if (isFinalResult) {
                        // ç»“æœæ˜¾ç¤ºäº”ç§’åæ¢å¤æ­£å¸¸
                        setTimeout(() => {
                            document.title = originalTitle;
                        }, 5000);
                    } else {
                        // æœ€ç»ˆæ¢å¤åŸæ ‡é¢˜
                        setTimeout(() => {
                            document.title = originalTitle;
                        }, 2000);
                    }
                }
                
                animateTitle();
            }

            function setLanguage(lang) {
                currentLanguage = lang;
                const t = translations[lang];
                
                elements.historyText.textContent = t.history;
                elements.historyTitle.textContent = t.history;
                elements.clearHistoryText.textContent = t.clearHistory;
                elements.historyNote.textContent = t.historyNote;
                elements.shareText.textContent = t.share;
                elements.mainTitle.textContent = t.mainTitle;
                elements.subTitle.textContent = t.subTitle;
                elements.disclaimer.textContent = t.disclaimer;
                elements.nameInput.placeholder = t.placeholder;
                elements.btnText.textContent = t.calculate;
                elements.resultForText.textContent = t.resultFor;
                elements.footerText.textContent = t.footer;
                elements.githubText.textContent = t.githubText;
                
                localStorage.setItem('repressionLanguage', lang);
                renderHistory();
            }

            function encodeBase64(str) {
                return btoa(encodeURIComponent(str));
            }

            function decodeBase64(str) {
                try {
                    return decodeURIComponent(atob(str));
                } catch (e) {
                    return null;
                }
            }

            function saveHistory(name, percentage, message, isFixed = false) {
                // è½¬ä¹‰ç”¨æˆ·è¾“å…¥ä»¥é˜²æ­¢XSS
                const escapedName = escapeHtml(name);
                const escapedMessage = escapeHtml(message);
                
                let history = JSON.parse(localStorage.getItem('repressionHistory') || '[]');
                history.unshift({ 
                    name: escapedName, 
                    percentage, 
                    message: escapedMessage, 
                    isFixed, 
                    timestamp: new Date().toLocaleString(), 
                    language: currentLanguage 
                });
                if (history.length > 10) history = history.slice(0, 10);
                localStorage.setItem('repressionHistory', JSON.stringify(history));
                renderHistory();
            }

            function renderHistory() {
                const history = JSON.parse(localStorage.getItem('repressionHistory') || '[]');
                elements.historyList.innerHTML = '';
                
                if (history.length === 0) {
                    const emptyItem = document.createElement('li');
                    emptyItem.className = 'text-gray-500';
                    emptyItem.textContent = currentLanguage === 'zh-CN' ? 'æš‚æ— å†å²è®°å½•' : 'No history yet';
                    elements.historyList.appendChild(emptyItem);
                    return;
                }
                
                history.forEach((item, index) => {
                    const listItem = document.createElement('li');
                    listItem.className = 'p-2 bg-gray-700 rounded-md flex justify-between items-center cursor-pointer hover:bg-gray-600 transition duration-200';
                    
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'flex-grow min-w-0';
                    
                    const nameSpan = document.createElement('span');
                    nameSpan.className = 'font-semibold text-blue-300';
                    nameSpan.textContent = item.name;
                    
                    const percentageSpan = document.createElement('span');
                    percentageSpan.className = 'font-bold text-white';
                    percentageSpan.textContent = `: ${item.percentage}%`;
                    
                    const messageP = document.createElement('p');
                    messageP.className = 'text-xs text-gray-400 mt-1 truncate';
                    messageP.textContent = item.message;
                    
                    contentDiv.appendChild(nameSpan);
                    contentDiv.appendChild(percentageSpan);
                    contentDiv.appendChild(messageP);
                    
                    // æ·»åŠ å›ºå®šæ ‡ç­¾ï¼ˆå¦‚æœéœ€è¦ï¼‰
                    if (item.isFixed) {
                        const fixedTag = document.createElement('span');
                        fixedTag.className = 'fixed-name-tag';
                        fixedTag.textContent = currentLanguage === 'zh-CN' ? 'å›ºå®š' : 'Fixed';
                        contentDiv.appendChild(fixedTag);
                    }
                    
                    const recallButton = document.createElement('button');
                    recallButton.className = 'recall-history text-blue-400 hover:text-blue-300 text-sm flex-shrink-0 whitespace-nowrap ml-2 px-3 py-1 rounded-md border border-blue-400 hover:bg-blue-700 transition duration-200';
                    recallButton.dataset.index = index;
                    recallButton.textContent = currentLanguage === 'zh-CN' ? 'æŸ¥çœ‹' : 'View';
                    
                    listItem.appendChild(contentDiv);
                    listItem.appendChild(recallButton);
                    
                    elements.historyList.appendChild(listItem);
                });
            }

            function recallHistoryItem(index) {
                const history = JSON.parse(localStorage.getItem('repressionHistory') || '[]');
                if (history[index]) {
                    const item = history[index];
                    elements.nameInput.value = item.name;
                    displayResult(item.name, item.percentage, item.message, item.isFixed);
                    elements.historyPanel.classList.add('hidden');
                }
            }

            function normalizeName(name) {
                let processedName = name.trim().toLowerCase();
                if (/[\u4e00-\u9fa5]/.test(processedName)) {
                    processedName = pinyin.pinyin(processedName, { style: pinyin.STYLE_NORMAL }).flat().join('');
                } else if (wanakana.isJapanese(processedName)) {
                    processedName = wanakana.toRomaji(processedName);
                }
                const letters = processedName.replace(/[^a-z]/g, '');
                const numbers = processedName.replace(/[^0-9]/g, '');
                const specials = processedName.replace(/[^a-z0-9]/g, '');
                return { letters, numbers, specials };
            }

            function getNumericValues(normalizedParts) {
                const letterValues = normalizedParts.letters.split('').map(char => char.charCodeAt(0) - 96);
                const numberSum = normalizedParts.numbers.split('').reduce((acc, digit) => acc + parseInt(digit, 10), 0);
                const specialSum = normalizedParts.specials.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
                return { letterValues, numberSum, specialSum };
            }

            function repressionCalculation(values, originalName) {
                const { letterValues, numberSum, specialSum } = values;
                if (letterValues.length === 0 && numberSum === 0 && specialSum === 0) return 0;

                const t = translations['zh-CN'];
                const fixedNameKeys = Object.keys(t.specialNames);
                for (const key of fixedNameKeys) {
                    if (originalName.toLowerCase() === key.toLowerCase()) return t.specialNames[key].percentage;
                }

                const letterSum = letterValues.reduce((acc, val) => acc + val, 0);
                const letterAvg = letterValues.length > 0 ? letterSum / letterValues.length : 0;
                const numberFactor = numberSum % 9 === 0 ? 1.2 : 0.8;
                const specialFactor = 1 + (specialSum % 100) / 200;
                const lengthFactor = Math.min(originalName.length / 5, 2);
                let repressionScore = (letterAvg * 3 + numberSum * 0.7) * specialFactor * numberFactor;
                repressionScore = repressionScore * lengthFactor;
                const nameHash = simpleHash(originalName);
                const randomFactor = 0.9 + (nameHash % 20) / 100;
                repressionScore = repressionScore * randomFactor;
                let result = Math.min(100, Math.max(0, Math.round(repressionScore % 101)));
                return isNaN(result) ? 50 : result;
            }

            function simpleHash(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash |= 0;
                }
                return Math.abs(hash);
            }

            function getResultMessage(percentage, name, isFixed = false) {
                if (isFixed) {
                    const t = translations['zh-CN'];
                    const fixedNameKeys = Object.keys(t.specialNames);
                    for (const key of fixedNameKeys) {
                        if (name.toLowerCase() === key.toLowerCase()) return t.specialNames[key].message;
                    }
                }

                let selectedTier;
                if (percentage === 0) selectedTier = messageTiers[0];
                else if (percentage <= 20) selectedTier = messageTiers[20];
                else if (percentage <= 40) selectedTier = messageTiers[40];
                else if (percentage <= 60) selectedTier = messageTiers[60];
                else if (percentage <= 80) selectedTier = messageTiers[80];
                else if (percentage <= 90) selectedTier = messageTiers[90];
                else selectedTier = messageTiers[100];

                const messageIndex = simpleHash(name + percentage) % selectedTier.length;
                return selectedTier[messageIndex];
            }
            
            function getProgressBarColor(percentage) {
                const colors = [ 
                    { p: 0, color: '#3b82f6' }, { p: 25, color: '#2563eb' }, 
                    { p: 50, color: '#1d4ed8' }, { p: 75, color: '#1e40af' }, 
                    { p: 100, color: '#1e3a8a' }
                ];
                for (let i = 1; i < colors.length; i++) {
                    if (percentage <= colors[i].p) {
                        const p1 = colors[i-1].p, p2 = colors[i].p;
                        const c1 = colors[i-1].color, c2 = colors[i].color;
                        const factor = (p2 - p1 === 0) ? 1 : (percentage - p1) / (p2 - p1);
                        const r1 = parseInt(c1.substring(1,3),16), g1 = parseInt(c1.substring(3,5),16), b1 = parseInt(c1.substring(5,7),16);
                        const r2 = parseInt(c2.substring(1,3),16), g2 = parseInt(c2.substring(3,5),16), b2 = parseInt(c2.substring(5,7),16);
                        const r = Math.round(r1 + factor * (r2-r1)), g = Math.round(g1 + factor * (g2-g1)), b = Math.round(b1 + factor * (b2-b1));
                        return `rgb(${r},${g},${b})`;
                    }
                }
                return colors[colors.length - 1].color;
            }

            function typeWriter(text, element, speed = 30) {
                clearInterval(typingInterval);
                element.textContent = '';
                let i = 0;
                typingInterval = setInterval(() => {
                    if (i < text.length) {
                        element.textContent += text.charAt(i);
                        i++;
                    } else {
                        clearInterval(typingInterval);
                    }
                }, speed);
            }

            function displayResult(name, percentage, message, isFixed = false) {
                // è½¬ä¹‰ç”¨æˆ·è¾“å…¥ä»¥é˜²æ­¢XSS
                const escapedName = escapeHtml(name);
                const escapedMessage = escapeHtml(message);
                
                elements.resultName.textContent = escapedName;
                elements.resultSection.classList.remove('hidden');
                elements.shareButton.classList.remove('hidden');
                elements.resultMessage.textContent = '';
                elements.percentageText.textContent = '0%';
                elements.progressBar.style.width = '0%';
                elements.progressBar.style.backgroundColor = getProgressBarColor(0);
                elements.fixedNameBadge.classList.toggle('hidden', !isFixed);
                
                // æ·»åŠ å¡ç‰‡æµ®ç°åŠ¨ç”»
                elements.resultSection.classList.add('pop-in');
                
                // åªæœ‰å½“è¿›åº¦â‰¥100%æ—¶æ‰æ˜¾ç¤ºå›½å®¶ä¼ æ’­æç¤º
                if (percentage >= 100) {
                    const countryName = countryMap[currentLanguage];
                    const t = translations[currentLanguage];
                    const alertText = t.countryAlert.replace('{}', countryName);
                    elements.countryAlertText.textContent = alertText;
                    elements.countryAlert.classList.remove('hidden');
                    elements.countryAlert.classList.add('card-float'); // æ·»åŠ æµ®åŠ¨åŠ¨ç”»
                } else {
                    elements.countryAlert.classList.add('hidden');
                }
                
                elements.githubLink.classList.remove('hidden');
                
                // å¯åŠ¨æµè§ˆå™¨æ ‡é¢˜åŠ¨ç”»
                updateTitleAnimation(0);
                
                let currentPercentage = 0;
                const increment = percentage / 50;
                const progressInterval = setInterval(() => {
                    currentPercentage += increment;
                    if (currentPercentage >= percentage) {
                        currentPercentage = percentage;
                        clearInterval(progressInterval);
                        
                        // è¿›åº¦å®Œæˆåæ˜¾ç¤ºå®Œæ•´æ¶ˆæ¯
                        typeWriter(escapedMessage, elements.resultMessage, 50);
                        
                        // æ·»åŠ è½»å¾®æµ®åŠ¨åŠ¨ç”»åˆ°ç»“æœå¡ç‰‡
                        elements.resultSection.classList.add('card-float');
                    }
                    
                    // æ ¹æ®æ•°å€¼å†³å®šæ˜¯å¦æ˜¾ç¤ºå°æ•°ç‚¹
                    if (currentPercentage % 1 === 0) {
                        elements.percentageText.textContent = `${Math.round(currentPercentage)}%`;
                    } else {
                        elements.percentageText.textContent = `${currentPercentage.toFixed(4)}%`;
                    }
                    elements.progressBar.style.width = `${currentPercentage}%`;
                    elements.progressBar.style.backgroundColor = getProgressBarColor(currentPercentage);
                    
                    // æ›´æ–°æµè§ˆå™¨æ ‡é¢˜åŠ¨ç”»
                    if (currentPercentage >= percentage) {
                        updateTitleAnimation(currentPercentage, true); // ä¼ é€’ true è¡¨ç¤ºæ˜¯æœ€ç»ˆç»“æœ
                    } else {
                        updateTitleAnimation(currentPercentage);
                    }
                    
                    if (currentPercentage > 20) {
                        elements.percentageText.style.opacity = '1';
                    }
                }, 20);
            }

            function calculateRepression() {
                const name = elements.nameInput.value.trim();
                if (!name) {
                    elements.nameInput.classList.add('shake');
                    setTimeout(() => elements.nameInput.classList.remove('shake'), 500);
                    return;
                }
                
                // æ·»åŠ è¾“å…¥æ¡†å¾®å…‰æ•ˆæœ
                elements.nameInput.classList.add('input-glow');
                setTimeout(() => elements.nameInput.classList.remove('input-glow'), 2000);
                
                elements.btnText.classList.add('hidden');
                elements.btnSpinner.classList.remove('hidden');
                
                setTimeout(() => {
                    const normalized = normalizeName(name);
                    const values = getNumericValues(normalized);
                    
                    const t = translations['zh-CN'];
                    const fixedNameKeys = Object.keys(t.specialNames);
                    let isFixed = false;
                    for (const key of fixedNameKeys) {
                        if (name.toLowerCase() === key.toLowerCase()) {
                            isFixed = true;
                            break;
                        }
                    }
                    
                    const percentage = repressionCalculation(values, name);
                    const message = getResultMessage(percentage, name, isFixed);
                    
                    displayResult(name, percentage, message, isFixed);
                    saveHistory(name, percentage, message, isFixed);
                    
                    elements.btnText.classList.remove('hidden');
                    elements.btnSpinner.classList.add('hidden');
                }, 1000);
            }

            // äº‹ä»¶ç›‘å¬å™¨
            elements.calculateBtn.addEventListener('click', (e) => {
                createRipple(e);
                calculateRepression();
            });

            elements.nameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    calculateRepression();
                }
            });

            elements.shareButton.addEventListener('click', () => {
                const name = elements.nameInput.value.trim();
                if (!name) return;
                
                const resultUrl = `${window.location.origin}${window.location.pathname}?name=${encodeURIComponent(name)}`;
                if (navigator.share) {
                    navigator.share({
                        title: translations[currentLanguage].mainTitle,
                        text: `${name}çš„æ€§å‹æŠ‘æŒ‡æ•°è®¡ç®—ç»“æœ`,
                        url: resultUrl
                    }).catch(() => {
                        navigator.clipboard.writeText(resultUrl).then(() => {
                            alert(currentLanguage === 'zh-CN' ? 'é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼' : 'Link copied to clipboard!');
                        });
                    });
                } else {
                    navigator.clipboard.writeText(resultUrl).then(() => {
                        alert(currentLanguage === 'zh-CN' ? 'é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼' : 'Link copied to clipboard!');
                    });
                }
            });

            elements.historyToggleBtn.addEventListener('click', () => {
                elements.historyPanel.classList.toggle('hidden');
            });

            elements.clearHistoryBtn.addEventListener('click', () => {
                localStorage.removeItem('repressionHistory');
                renderHistory();
            });

            elements.historyList.addEventListener('click', (e) => {
                if (e.target.classList.contains('recall-history')) {
                    const index = parseInt(e.target.dataset.index);
                    recallHistoryItem(index);
                }
            });

            elements.languageSelect.addEventListener('change', (e) => {
                setLanguage(e.target.value);
            });

            // åˆå§‹åŒ–
            const savedLanguage = localStorage.getItem('repressionLanguage');
            if (savedLanguage && translations[savedLanguage]) {
                elements.languageSelect.value = savedLanguage;
                setLanguage(savedLanguage);
            } else {
                setLanguage(currentLanguage);
            }

            const urlParams = new URLSearchParams(window.location.search);
            const nameParam = urlParams.get('name');
            if (nameParam) {
                elements.nameInput.value = decodeURIComponent(nameParam);
                calculateRepression();
            }

            renderHistory();
        };
    </script>
</body>
</html>
